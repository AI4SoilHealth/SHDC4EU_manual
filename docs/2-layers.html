<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Soil Health Data Cube for Europe</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<meta property="og:title" content="Soil Health Data Cube for Europe">
<meta property="og:description" content="Soil Health Data Cube for pan-EU (SHDC4EU) is compilation of pan-EU layers organized into a data cube and served through an API as analysis or decision ready data.">
<meta property="og:site_name" content="Soil Health Data Cube for Europe">
<meta name="twitter:title" content="Soil Health Data Cube for Europe">
<meta name="twitter:description" content="">
<meta name="twitter:image" content="images/cover.png">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="./index.html" class="navbar-brand navbar-brand-logo">
    <img src="././images/logo_ai4soilhealth_square.bw.short.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Soil Health Data Cube for Europe</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="https://github.com/ai4soilhealth"> 
<span class="menu-text">Project repositories</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="https://ai4soilhealth.eu"> 
<span class="menu-text">AI4SoilHealth project</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools tools-wide">
    <a href="https://fosstodon.org/@opengeohub" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-mastodon"></i></a>
    <a href="https://opengeohub.medium.com/" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-medium"></i></a>
    <a href="https://twitter.com/AI4SoilHealth" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-twitter"></i></a>
    <div class="dropdown">
      <a href="" title="" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label=""><i class="bi bi-github"></i></a>
      <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="quarto-navigation-tool-dropdown-0">
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/AI4SoilHealth/SHDC4EU_manual">
            Source Code
            </a>
          </li>
          <li>
            <a class="dropdown-item quarto-navbar-tools-item" href="https://github.com/AI4SoilHealth/SHDC4EU_manual/issues">
            Report a Bug
            </a>
          </li>
      </ul>
    </div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./index.html">Soil Health Data Cube components</a></li><li class="breadcrumb-item"><a href="./2-layers.html">Available layers</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">Soil Health Data Cube components</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./preface.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./1-specifications.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Soil Health Data Cube specifications</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./2-layers.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Available layers</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">Data use tutorials</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./3-points.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Point Data Import and Quality Control</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#available-layers" id="toc-available-layers" class="nav-link active" data-scroll-target="#available-layers">Available layers</a>
  <ul class="collapse">
  <li><a href="#pan-eu-landmask" id="toc-pan-eu-landmask" class="nav-link" data-scroll-target="#pan-eu-landmask">Pan-EU Landmask</a></li>
  <li><a href="#landsat-based-spectral-indices-data-cube" id="toc-landsat-based-spectral-indices-data-cube" class="nav-link" data-scroll-target="#landsat-based-spectral-indices-data-cube">Landsat-based Spectral Indices Data Cube</a>
  <ul class="collapse">
  <li><a href="#summary" id="toc-summary" class="nav-link" data-scroll-target="#summary">Summary</a></li>
  <li><a href="#access-to-the-data-cube" id="toc-access-to-the-data-cube" class="nav-link" data-scroll-target="#access-to-the-data-cube">Access to the data cube</a></li>
  <li><a href="#contacts-and-issues" id="toc-contacts-and-issues" class="nav-link" data-scroll-target="#contacts-and-issues">Contacts and issues</a></li>
  </ul></li>
  <li><a href="#predictive-models-for-soil-properties" id="toc-predictive-models-for-soil-properties" class="nav-link" data-scroll-target="#predictive-models-for-soil-properties">Predictive models for soil properties</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#input-materials" id="toc-input-materials" class="nav-link" data-scroll-target="#input-materials">Input materials</a></li>
  <li><a href="#pipeline-description" id="toc-pipeline-description" class="nav-link" data-scroll-target="#pipeline-description">Pipeline Description</a></li>
  <li><a href="#contacts" id="toc-contacts" class="nav-link" data-scroll-target="#contacts">Contacts</a></li>
  </ul></li>
  <li><a href="#m-resolution-maps-of-socd-and-prediction-uncertainty-for-europe-20002022-in-3dt" id="toc-m-resolution-maps-of-socd-and-prediction-uncertainty-for-europe-20002022-in-3dt" class="nav-link" data-scroll-target="#m-resolution-maps-of-socd-and-prediction-uncertainty-for-europe-20002022-in-3dt">30-m resolution maps of SOCD and prediction uncertainty for Europe (2000–2022) in 3D+T</a>
  <ul class="collapse">
  <li><a href="#summary-1" id="toc-summary-1" class="nav-link" data-scroll-target="#summary-1">Summary</a></li>
  </ul></li>
  <li><a href="#m-resolution-maps-of-soil-types-wrb" id="toc-m-resolution-maps-of-soil-types-wrb" class="nav-link" data-scroll-target="#m-resolution-maps-of-soil-types-wrb">30-m resolution maps of soil types (WRB)</a>
  <ul class="collapse">
  <li><a href="#summary-2" id="toc-summary-2" class="nav-link" data-scroll-target="#summary-2">Summary</a></li>
  </ul></li>
  <li><a href="#disclaimer" id="toc-disclaimer" class="nav-link" data-scroll-target="#disclaimer">Disclaimer</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><ul><li><a href="https://github.com/AI4SoilHealth/SHDC4EU_manual/edit/main/2-layers.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/AI4SoilHealth/SHDC4EU_manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">




<section id="available-layers" class="level1">
<h1>Available layers</h1>
<p>This section systematically list all layers provided within the AI4SoilHealth Soil Health Data Cube for Europe. Note, the list if constantly updated. Some layers are available on Zenodo and on S3, but most layers are only available on S3. The total size of all data is at the order of 20 to 30TB.</p>
<p>In principle, the data in SHDC is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC-BY</a>, and the code is licensed under the MIT License. Training points are used under various terms and conditions.</p>
<section id="pan-eu-landmask" class="level2">
<h2 class="anchored" data-anchor-id="pan-eu-landmask">Pan-EU Landmask</h2>
<p><a rel="license" href="https://zenodo.org/doi/10.5281/zenodo.8171860"><img alt="DOI" style="border-width:0" src="https://zenodo.org/badge/DOI/10.5281/zenodo.8171860.svg"></a><br></p>
<p><a href="https://zenodo.org/doi/10.5281/zenodo.8171860">Three Pan-EU land masks</a> designed for different specific applications in the production of soil health data cube:</p>
<ul>
<li><strong>Land mask</strong>: with values differentiating land, ocean, and inland water</li>
<li><strong>NUT-3 code map</strong>: with values differentiating administrative area at nut-3 level</li>
<li><strong>ISO-3166 country code map</strong>: with values differentiating countries according to ISO-3166 standard The jupyter notebooks and bash files that are used to produce masks, merge tiles, reproject coordinate systems, and resample to another resolution.</li>
</ul>
<p>All the landmasks are aligned with the standard spatial/temporal resolution and sizes indicated/recommended by AI4SoilHealth project, WP5. The coverage of these maps closely match the data coverage of https://land.copernicus.eu/pan-european i.e.&nbsp;the official selection of countries listed here: https://lanEEA39d.copernicus.eu/portal_vocabularies/geotags/eea39:</p>
<ul>
<li><strong>Land mask</strong>: with values differentiating land, ocean, and inland water;</li>
<li><strong>NUT-3 code map</strong>: with values differentiating administrative area at nut-3 level;</li>
<li><strong>ISO-3166 country code map</strong>: with values differentiating countries according to ISO-3166 standard;</li>
</ul>
<p>The jupyter notebooks and bash files that are used to produce masks, merge tiles, reproject crs, and resample to another resolution.</p>
<p>All the landmasks are aligned with the standard spatial/temporal resolution and sizes indicated/recomended by AI4SoilHealth project, WP5. The coverage of these maps closely match the data coverage of <a href="https://land.copernicus.eu/pan-european" class="uri">https://land.copernicus.eu/pan-european</a> i.e.&nbsp;the official selection of countries listed here: <a href="https://lanEEA39d.copernicus.eu/portal_vocabularies/geotags/eea39" class="uri">https://lanEEA39d.copernicus.eu/portal_vocabularies/geotags/eea39</a>.</p>
<p>These masks are created by <a href="xuemeng.tian@opengeohub.org">Xuemeng</a>, <a href="yu-feng.ho@opengeohub.org">Yu-Feng</a>, and <a href="martijn.witjes@opengeohub.org">Martijn</a> from <a href="https://opengeohub.org/">OpenGeoHub</a>. If you spot any problems in the land masks, or see any possible improvements in them, or have any questions, just raise an issue <a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/issues">here</a> or send us emails! We appreciate any feedback that could refine these masks.</p>
</section>
<section id="landsat-based-spectral-indices-data-cube" class="level2">
<h2 class="anchored" data-anchor-id="landsat-based-spectral-indices-data-cube">Landsat-based Spectral Indices Data Cube</h2>
<p><a rel="license" href="https://zenodo.org/doi/10.5281/zenodo.10776891"><img alt="DOI" style="border-width:0" src="https://zenodo.org/badge/DOI/10.5281/zenodo.10776891.svg"></a><br></p>
<p>This data cube offers a time-series of Landsat-based spectral indices maps across continental Europe including Ukraine, the UK, and Turkey from 2000 to 2022. At a resolution of 30-meters, it includes bi-monthly, annual, and long-term analyses, focusing on key aspects of soil health such as vegetation cover, soil exposure, tillage practices, and crop intensity. Apart from direct monitoring, analysis, and verification of specific aspects of soil health, this data cube also provides important input for modeling and mapping soil properties. All the maps are aligned with the standard spatial/temporal resolution and sizes indicated/recomended by AI4SoilHealth project, WP5.</p>
<p>Please cite as:</p>
<pre><code>@Article{tian2024time,
AUTHOR = {Tian, X. and Consoli, D. and Witjes, M. and Schneider, F. and Parente, L. and \c{S}ahin, M. and Ho, Y.-F. and Mina\v{r}\'{\i}k, R. and Hengl, T.},
TITLE = {Time-series of Landsat-based bi-monthly and annual spectral indices for continental Europe for 2000--2022},
JOURNAL = {Earth System Science Data Discussions},
VOLUME = {2024},
YEAR = {2024},
PAGES = {1--49},
URL = {https://essd.copernicus.org/preprints/essd-2024-266/},
DOI = {10.5194/essd-2024-266}
}</code></pre>
<section id="summary" class="level3">
<h3 class="anchored" data-anchor-id="summary">Summary</h3>
<p>The <a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/tree/main/landsat_based_spectral_indices">corresponding folder</a> provides:</p>
<ol type="1">
<li>Essential code &amp; data used to generate/analyze/visualize/upload the landsat-based spectral indices data cube,</li>
<li>Visualization for selected indices.</li>
</ol>
<p>The indices include:</p>
<ul>
<li><strong>Vegetation index</strong>: Normalized Difference Vegetation Index (NDVI), Soil Adjusted Vegetation Index (SAVI), and Fraction of Absorbed Photosynthetically Active Radiation (FAPAR).</li>
<li><strong>Soil exposure</strong>: Bare Soil Fraction (BSF).</li>
<li><strong>Tillage and soil sealing</strong>: Normalized Difference Tillage Index (NDTI) and minimum Normalized Difference Tillage Index (minNDTI).</li>
<li><strong>Crop patterns</strong>: Number of Seasons (NOS) and Crop Duration Ratio (CDR).</li>
<li><strong>Water dynamics</strong>: Normalized Difference Snow Index (NDSI) and Normalized Difference Water Index (NDWI)</li>
</ul>
<p>General steps of maps production are described below:</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/landsat_datacube_workflow.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>General workflow for processing Landsat-based spectral index predictors. Image source: <span class="citation" data-cites="tian2024time">Tian et al. (<a href="#ref-tian2024time" role="doc-biblioref">2024</a>)</span>.</figcaption>
</figure>
</div>
</div>
</div>
<p>A preview of the BSF (%) time series for the former Szczakowa sand mine, south Poland is shown below.</p>
<div class="cell">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/landsat_example_bsf_ndvi_ndwi.jpg" class="img-fluid figure-img" style="width:90.0%"></p>
<figcaption>The top panel provides zoomed-in view of NDVI, NDWI and BSF trends for the former Szczakowa sand mine, south Poland. Image source: <span class="citation" data-cites="tian2024time">Tian et al. (<a href="#ref-tian2024time" role="doc-biblioref">2024</a>)</span>.</figcaption>
</figure>
</div>
</div>
</div>
</section>
<section id="access-to-the-data-cube" class="level3">
<h3 class="anchored" data-anchor-id="access-to-the-data-cube">Access to the data cube</h3>
<p>To ensure accessibility and proper usage of the dataset, we have distributed the data across multiple platforms for different purposes:</p>
<ol type="1">
<li><strong>Zenodo</strong> <a href="https://zenodo.org/communities/ai4soilhealth" class="uri">https://zenodo.org/communities/ai4soilhealth</a>
<ul>
<li>This dataset is registered on Zenodo with preview visualization and a valid DOI: <a href="https://doi.org/10.5281/zenodo.10776891" class="uri">https://doi.org/10.5281/zenodo.10776891</a>.</li>
<li>Due to the storage limit of Zenodo in each bucket, uploading all data layers to Zenodo is impractical and not beneficial for users as it would be too distributed. Therefore, for bimonthly predictors, only data layers for the years 2000 and 2022 are uploaded. All the annual and long-term predictors are available, though.</li>
</ul></li>
<li><strong>Wasabi cloud</strong>
<ul>
<li>The complete dataset is hosted on Wasabi’s cloud in COG format, enabling efficient storage, retrieval, and secure data management.</li>
<li>A comprehensive index of all the data layers stored and maintained on Wasabi.com is available through a <a href="https://docs.google.com/spreadsheets/d/1QTA6OkkYlZljfHst_inCrkC7DJcMAyHnM9k0iHulwpg/edit?usp=sharing">navigation catalog in a Google Sheet</a>, facilitating the indexing, finding, and downloading of all the predictor layers.</li>
</ul></li>
</ol>
</section>
<section id="contacts-and-issues" class="level3">
<h3 class="anchored" data-anchor-id="contacts-and-issues">Contacts and issues</h3>
<p>The SHDC data was created by <a href="xuemeng.tian@opengeohub.org">Xuemeng</a>, <a href="davide.consoli@opengeohub.org">Davide</a>, <a href="leandro.parente@opengeohub.org">Leandro</a>, and <a href="yu-feng.ho@opengeohub.org">Yu-Feng</a> from <a href="https://opengeohub.org/">OpenGeoHub</a>. If you spot any problems in the maps, or see any possible improvements in them, or see any potential collaborations, or etc…, just raise an issue <a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/issues">here</a> or send us emails! We appreciate any feedbacks/helps that could refine them.</p>
</section>
</section>
<section id="predictive-models-for-soil-properties" class="level2">
<h2 class="anchored" data-anchor-id="predictive-models-for-soil-properties">Predictive models for soil properties</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">Overview</h3>
<p>The folder <strong><a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/tree/main/soil_property_model_pipeline">soil_property_model_pipeline</a></strong> contains scripts used to build predictive models for 10 key soil properties:</p>
<ol type="1">
<li>Soil Organic Carbon (SOC)</li>
<li>Nitrogen (N)</li>
<li>Carbonate (CaCO3)</li>
<li>Cation Exchange Capacity (CEC)</li>
<li>Electrical Conductivity (EC)</li>
<li>pH in Water</li>
<li>pH in CaCl2 Solution</li>
<li>Bulk Density</li>
<li>Extractable Phosphorus (P)</li>
<li>Extractable Potassium (K)</li>
</ol>
<p>The <a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/tree/main/SOCD_map">notebooks and their content</a>:</p>
<ul>
<li><strong>Notebooks (001 – 009)</strong>
<ul>
<li>Designed to test various steps in the predictive model building process</li>
<li>Explore and validate different methodologies and approaches for model construction</li>
</ul></li>
<li><strong>Benchmark Pipeline Script</strong>
<ul>
<li><code>benchmark_pipeline.py</code> automates the entire model-building pipeline</li>
<li>Streamlines the process based on the initial 10 notebooks</li>
</ul></li>
<li><strong>Property-Specific Modeling (010 – 011)</strong>
<ul>
<li>Notebooks with indices <code>010 -- 011</code> loop the pipeline through different soil properties</li>
<li>Identify and optimize the best model for each property</li>
</ul></li>
<li><strong>Prediction Interval Models (012 – 014)</strong>
<ul>
<li>Notebooks with indices <code>012 -- 014</code> build models that estimate prediction intervals</li>
<li>Add a layer of uncertainty quantification to the predictions</li>
</ul></li>
</ul>
</section>
<section id="input-materials" class="level3">
<h3 class="anchored" data-anchor-id="input-materials">Input materials</h3>
<p>Predictions of soil properties are based on the following training and input data:</p>
<ul>
<li>The <strong>training data</strong> includes comprehensive metadata (sampling year, depth, location) and quality scores for each measurement, covering the above mentioned 10 properties. Details can be found in <a href="https://docs.google.com/spreadsheets/d/1J652XU_VWmbm1uLmeywlF6kfe7fUD5aJrfAIK97th1E/edit?usp=sharing">AI4SH soil data harmonization specifications</a>.</li>
<li>The <strong>features</strong> used for model fitting and map production contain around 450 covariate layers. Details can be found in <a href="https://docs.google.com/spreadsheets/d/1eIoPAvWM5jrhLrr25jwguAIR0YxOh3f5-CdXwpcOIz8/edit?usp=sharing">AI4SH soil health data cube covariates preparation</a>. These layers comply with the technical specifications outlined in D5.1: Soil Health Data Cube, ensuring they are well-suited for integration, cross-comparison, and subsequent map production. The covariate layers include a diverse range of geospatial layers detailing various environmental conditions, categorized into:
<ul>
<li>Climate</li>
<li><a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/tree/main?tab=readme-ov-file#landsat-based-spectral-indices-data-cube">Landsat-based spectral indices</a></li>
<li>Parental material</li>
<li>Water cycle</li>
<li>Terrain</li>
<li>Human pressure factors</li>
</ul></li>
</ul>
</section>
<section id="pipeline-description" class="level3">
<h3 class="anchored" data-anchor-id="pipeline-description">Pipeline Description</h3>
<p>A standardized pipeline has been developed to automate model development for predicting soil properties. This pipeline enhances model performance through hyper-parameter tuning, feature selection, and cross-validation. The process begins with inputting harmonized soil data, covariate paths, and a defined quality score threshold to ensure data reliability. The inputs, processing steps and outputs are <span class="citation" data-cites="tian2025socd">(<a href="#ref-tian2025socd" role="doc-biblioref">Tian et al. 2024?</a>)</span>:</p>
<ul>
<li><strong>Input Data Preparation</strong>:
<ul>
<li>Harmonized soil data</li>
<li>List of covariate paths</li>
<li>Quality score threshold</li>
</ul></li>
<li><strong>Model Candidates</strong>:
<ul>
<li>Artificial Neural Network (ANN)</li>
<li>Random Forest (RF)</li>
<li>LightGBM</li>
<li>Weighted variants (excluding ANN due to scikit-learn limitations)</li>
</ul></li>
<li><strong>Processing steps</strong>:
<ol type="1">
<li>Separate calibration, training and testing dataset:
<ul>
<li>Validation Dataset: 5000 soil points selected from LUCAS through stratified random sampling.</li>
<li>Calibration Dataset: 20% of remaining soil data points selected in a stratified manner from each spatial block (approx. 120 km grids).</li>
<li>Training Dataset: remaining 80% soil data points.</li>
</ul></li>
<li>Calibration using calibration dataset
<ul>
<li>Feature Selection: Using a default Random Forest (RF) model from scikit-learn.</li>
<li>Hyper-parameter Tuning: Using HalvingGridSearch from scikit-learn.</li>
</ul></li>
<li>Cross-validation of base models on training dataset
<ul>
<li>Spatial Blocking Strategy: in each run, it is ensured that geographically proximate (approx. 120 km grids) soil points are not selected together.</li>
<li>Method: 5-fold spatially blocked cross-validation (CV).</li>
<li>Metrics: Coefficient of determination (R2), Root Mean Square Error (RMSE), Concordance Correlation Coefficient (CCC), and computation time.</li>
</ul></li>
<li>Testing on individual validation dataset
<ul>
<li>All 5 candidate models are trained on the whole training dataset.</li>
<li>And then being tested on the individual validation dataset, to get a set of objective metrics.</li>
</ul></li>
</ol></li>
<li><strong>Intemediate outputs during process</strong>:
<ul>
<li>Produces calibration and training datasets</li>
<li>Trained models</li>
<li>Sorted feature importance</li>
<li>Performance metrics and accuracy plots</li>
</ul></li>
<li><strong>Final Model</strong>
<ul>
<li>Selection: Model with the best overall performance across metrics for both CV and individual validation.</li>
<li>Training: Trained on the complete dataset of soil points using optimized features and parameters.</li>
<li><a href="https://scikit-garden.github.io/examples/QuantileRegressionForests/">Quantile Regression Model</a>: A quantile model will be trained with same parameters on the complete data set to estimate prediction intervals.</li>
<li>Map Production: Fully trained model used for soil property prediction and uncertainty map production.</li>
</ul></li>
</ul>
</section>
<section id="contacts" class="level3">
<h3 class="anchored" data-anchor-id="contacts">Contacts</h3>
<p>These maps are created by <a href="xuemeng.tian@opengeohub.org">Xuemeng</a>, <a href="rolf.simoes@opengeohub.org">Rolf</a>, <a href="davide.consoli@opengeohub.org">Davide</a>, <a href="leandro.parente@opengeohub.org">Leandro</a>, <a href="robert.minarik@opengeohub.org">Robert</a> and <a href="yu-feng.ho@opengeohub.org">Yu-Feng</a> from <a href="https://opengeohub.org/">OpenGeoHub</a>. If you spot any problems in the maps, or see any possible improvements in them, or see any potential collaborations, or etc…, just raise an issue <a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/issues">here</a> or send us emails! We appreciate any feedbacks/helps that could refine them.</p>
</section>
</section>
<section id="m-resolution-maps-of-socd-and-prediction-uncertainty-for-europe-20002022-in-3dt" class="level2">
<h2 class="anchored" data-anchor-id="m-resolution-maps-of-socd-and-prediction-uncertainty-for-europe-20002022-in-3dt">30-m resolution maps of SOCD and prediction uncertainty for Europe (2000–2022) in 3D+T</h2>
<section id="summary-1" class="level3">
<h3 class="anchored" data-anchor-id="summary-1">Summary</h3>
<p>The folder <strong><a href="https://github.com/AI4SoilHealth/SoilHealthDataCube/tree/main/SOCD_map">SOCD_map</a></strong> contains scripts used to test, train, evaluate predictive models for soil organic carbon density (SOCD, kg/m3) based on:</p>
<ul>
<li>22,428 lab measurements with both SOC content (g/kg) and fine earth (size &lt; 2mm) bulk density.</li>
<li>a wide range of environmental covariates, especially the time series of 30m Landsat-based spectral indices.</li>
</ul>
<p>The scripts used to generate the figures in the paper are also included.</p>
<p>Please cite as:</p>
<pre><code>@Article{tian2025socd,
AUTHOR = {Tian, X. and {de Bruin}, S. and Simoes, R. and Isik, M.S. and Mina\v{r}\'{\i}k, R. and Ho, Y.-F. and Sahin, M. and Herold, M. and Consoli and Hengl, T.},
TITLE = {Spatiotemporal prediction of soil organic carbon density for Europe (2000--2022) in 3D+T based on Landsat-based spectral indices time-series},
JOURNAL = {PeerJ},
VOLUME = {in review},
YEAR = {2024?},
PAGES = {1--49},
DOI = {10.21203/rs.3.rs-5128244/v1}
}</code></pre>
</section>
</section>
<section id="m-resolution-maps-of-soil-types-wrb" class="level2">
<h2 class="anchored" data-anchor-id="m-resolution-maps-of-soil-types-wrb">30-m resolution maps of soil types (WRB)</h2>
<section id="summary-2" class="level3">
<h3 class="anchored" data-anchor-id="summary-2">Summary</h3>
<p>The folder <strong>WRB_map</strong> contains scripts used to test, train, evaluate predictive models to map soil types based on the IUSS World Reference Base classification system. For this we used <span class="citation" data-cites="minarik2025wrb">(<a href="#ref-minarik2025wrb" role="doc-biblioref">Minařı́k et al. 2024?</a>)</span>:</p>
<ul>
<li>cca 19,000 training points with ground observation of soil types;</li>
<li>a wide range of environmental covariates, especially the time series of 30-m Landsat-based spectral indices;</li>
</ul>
<p>The scripts used to generate the figures in the paper are also included.</p>
<p>Please cite as:</p>
<pre><code>@Article{minarik2025wrb,
AUTHOR = {Mina\v{r}\'{\i}k, R. and Hengl, T. and Simoes, R. and Isik, M.S. and Ho, Y.-F. and Tian, X.},
TITLE = {Soil type (World Reference Base) map of Europe based on Ensemble Machine Learning and multiscale EO data},
JOURNAL = {PeerJ},
VOLUME = {in review},
YEAR = {2024?},
PAGES = {1--32},
DOI = {https://doi.org/10.21203/rs.3.rs-5244083/v1}
}</code></pre>
</section>
</section>
<section id="disclaimer" class="level2">
<h2 class="anchored" data-anchor-id="disclaimer">Disclaimer</h2>
<p>The production of these data layers are parts of <a href="https://cordis.europa.eu/project/id/101086179">AI4SoilHealth</a> project. The AI4SoilHealth project project has received funding from the European Union’s Horizon Europe research an innovation programme under grant agreement No.&nbsp;101086179. Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or European Commision. Neither the European Union nor the granting authority can be held responsible for them. The data is provided “as is”. AI4SoilHealth project consortium and its suppliers and licensors hereby disclaim all warranties of any kind, express or implied, including, without limitation, the warranties of merchantability, fitness for a particular purpose and non-infringement. Neither AI4SoilHealth Consortium nor its suppliers and licensors, makes any warranty that the Website will be error free or that access thereto will be continuous or uninterrupted. You understand that you download from, or otherwise obtain content or services through, the Website at your own discretion and risk.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-minarik2025wrb" class="csl-entry" role="listitem">
Minařı́k, R., T. Hengl, R. Simoes, M. S. Isik, Y.-F. Ho, and X. Tian. 2024? <span>“Soil Type (World Reference Base) Map of Europe Based on Ensemble Machine Learning and Multiscale EO Data.”</span> <em>PeerJ</em> in review (2024?): 1–32. https://doi.org/<a href="https://doi.org/10.21203/rs.3.rs-5244083/v1">https://doi.org/10.21203/rs.3.rs-5244083/v1</a>.
</div>
<div id="ref-tian2024time" class="csl-entry" role="listitem">
Tian, X., D. Consoli, M. Witjes, F. Schneider, L. Parente, M. Şahin, Y.-F. Ho, R. Minařı́k, and T. Hengl. 2024. <span>“Time-Series of Landsat-Based Bi-Monthly and Annual Spectral Indices for Continental Europe for 2000–2022.”</span> <em>Earth System Science Data Discussions</em> 2024: 1–49. <a href="https://doi.org/10.5194/essd-2024-266">https://doi.org/10.5194/essd-2024-266</a>.
</div>
<div id="ref-tian2025socd" class="csl-entry" role="listitem">
Tian, X., S. de Bruin, R. Simoes, M. S. Isik, R. Minařı́k, Y.-F. Ho, M. Sahin, M. Herold, Consoli, and T. Hengl. 2024? <span>“Spatiotemporal Prediction of Soil Organic Carbon Density for Europe (2000–2022) in 3D+t Based on Landsat-Based Spectral Indices Time-Series.”</span> <em>PeerJ</em> in review (2024?): 1–49. <a href="https://doi.org/10.21203/rs.3.rs-5128244/v1">https://doi.org/10.21203/rs.3.rs-5128244/v1</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2024, OpenGeoHub foundation</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/AI4SoilHealth/SHDC4EU_manual/edit/main/2-layers.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/AI4SoilHealth/SHDC4EU_manual/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
    <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/AI4SoilHealth/SHDC4EU_manual/">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://fosstodon.org/@opengeohub">
      <i class="bi bi-mastodon" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/AI4SoilHealth">
      <i class="bi bi-twitter" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.linkedin.com/company/opengeohub-foundation/">
      <i class="bi bi-linkedin" role="img">
</i> 
    </a>
  </li>  
    <li class="nav-item compact">
    <a class="nav-link" href="https://www.youtube.com/c/OpenGeoHubFoundation">
      <i class="bi bi-youtube" role="img">
</i> 
    </a>
  </li>  
</ul>
    </div>
  </div>
</footer>




</body></html>